import{a as P,b as R,c as T,d as g}from"./api-B2IVDk6a.js";import{E as C}from"./index-W_Xfc79R.js";import{m as F,Z as y,d as O,a as w,ah as p,p as V,q as M,t as u,U as e,O as n,S as f,M as x,R as k,u as b}from"./vue-DRvwLzXx.js";import"./base-BDaasHXh.js";import"./index-kI_rcZ0B.js";import"./crypto-BjADBdty.js";const j={class:"dialog-footer"},q=u("br",null,null,-1),L=u("br",null,null,-1),W=u("br",null,null,-1),Z=u("br",null,null,-1),z=u("h2",{class:"text-center"},"全部鲸币申请",-1),h="70px",G="370px",te=F({__name:"Supervise",setup(H){document.title="鲸币审批";let d=y([]),v=y([]);O(async()=>{let a=await P();d.push(...a);let l=await R();v.push(...l)});const c=w(!1),t=y({user_id:0,name:"",content:"",coin:0}),r=w(),U=w(),A=a=>{r.value=a},D=()=>{c.value=!0},I=async()=>{let a=await T({user_id:t.user_id,content:t.content,amount:t.coin});if(a.code==200){let l={id:a.coin_id,user_name:t.name,user_id:t.user_id,content:t.content,amount:t.coin,decision:!0,record_time:new Date,apply_status:!0,apply_time:new Date};v.splice(0,0,l),c.value=!1,r.value.balance=a.balance,r.value.id=a.coin_id,t.name="",t.content="",t.coin=0}},N=async()=>{var a=prompt("请确认要结算的鲸币数量","1");if(a&&a.length>0&&(console.log("同意"),(await g({action:"grant",notes:"同意",id:r.value.id,amount:Number(a)})).code==200)){let i=d.indexOf(r.value);i>-1&&d.splice(i,1)}},S=async()=>{let a="确定拒绝该鲸币申请-"+r.value.repo+"吗？";if(confirm(a)==!0&&(console.log("取消"),(await g({action:"reject",notes:r.value.notes,id:r.value.id,amount:r.value.amount})).code==200)){let i=d.indexOf(r.value);i>-1&&d.splice(i,1)}};return(a,l)=>{const i=p("el-button"),o=p("el-table-column"),m=p("el-input"),_=p("el-form-item"),B=p("el-form"),E=p("el-dialog");return V(),M("div",null,[u("div",null,[e(i,{type:"primary",onClick:D},{default:n(()=>[f("新增")]),_:1}),r.value?(V(),x(i,{key:0,type:"primary",onClick:N},{default:n(()=>[f("同意")]),_:1})):k("",!0),r.value?(V(),x(i,{key:1,type:"primary",onClick:S},{default:n(()=>[f("拒绝")]),_:1})):k("",!0)]),e(b(C),{ref_key:"singleTableRef",ref:U,data:b(d),stripe:"","highlight-current-row":"",style:{width:"100%"},onCurrentChange:A},{default:n(()=>[e(o,{prop:"user_name",label:"申请人"}),e(o,{prop:"repo",label:"仓库",width:"180"}),e(o,{prop:"role",label:"角色"}),e(o,{prop:"content",label:"内容"}),e(o,{prop:"record_time",label:"产生时间"}),e(o,{prop:"apply_status",label:"申请状态"}),e(o,{prop:"apply_time",label:"申请时间"})]),_:1},8,["data"]),e(E,{modelValue:c.value,"onUpdate:modelValue":l[4]||(l[4]=s=>c.value=s),width:G,center:!0,title:"鲸币新增"},{footer:n(()=>[u("span",j,[e(i,{type:"primary",onClick:I},{default:n(()=>[f("确定")]),_:1})])]),default:n(()=>[e(B,{model:t},{default:n(()=>[e(_,{label:"ID","label-width":h},{default:n(()=>[e(m,{modelValue:t.user_id,"onUpdate:modelValue":l[0]||(l[0]=s=>t.user_id=s),autocomplete:"off"},null,8,["modelValue"])]),_:1}),e(_,{label:"名字","label-width":h},{default:n(()=>[e(m,{modelValue:t.name,"onUpdate:modelValue":l[1]||(l[1]=s=>t.name=s),autocomplete:"off"},null,8,["modelValue"])]),_:1}),e(_,{label:"内容","label-width":h},{default:n(()=>[e(m,{modelValue:t.content,"onUpdate:modelValue":l[2]||(l[2]=s=>t.content=s),autocomplete:"off"},null,8,["modelValue"])]),_:1}),e(_,{label:"鲸币","label-width":h},{default:n(()=>[e(m,{modelValue:t.coin,"onUpdate:modelValue":l[3]||(l[3]=s=>t.coin=s),autocomplete:"off"},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue"]),q,L,W,Z,z,e(b(C),{data:b(v),stripe:"","highlight-current-row":"",style:{width:"100%"}},{default:n(()=>[e(o,{prop:"user_name",label:"申请人"}),e(o,{prop:"repo",label:"仓库",width:"80"}),e(o,{prop:"role",label:"角色"}),e(o,{prop:"content",label:"内容"}),e(o,{prop:"amount",label:"数额"}),e(o,{prop:"record_time",label:"产生时间"}),e(o,{prop:"apply_status",label:"申请状态"}),e(o,{prop:"apply_time",label:"申请时间"}),e(o,{prop:"decision",label:"审批决定"})]),_:1},8,["data"])])}}});export{te as default};
