import{j as I,b as R,s as A,k as M,l as P}from"./api-B2IVDk6a.js";import{a as l,E as B}from"./index-BtR1NTjQ.js";import{m as E,a as d,Z as N,d as b,ah as w,p as n,q as m,t as y,M as x,O as u,S as _,R as v,U as r,T as V,u as k}from"./vue-DRvwLzXx.js";import"./base-BDaasHXh.js";import"./index-kI_rcZ0B.js";import"./crypto-BjADBdty.js";const j={class:"flex flex-col items-center justify-center space-y-2 p-4"},T={class:"flex flex-row items-center justify-center space-x-4"},D={key:0,class:"text-green-500 mt-2"},F={key:1,class:"text-red-500 mt-2"},q={key:2,class:"text-gray-500 mt-2"},O=y("br",null,null,-1),Z=y("h2",{class:"text-center"},"全部鲸币申请",-1),Q=E({__name:"FetchRepo",setup($){const p=d(null);document.title="数据更新";let h=N([]);const i=async()=>{var t;try{const s=await R();h.splice(0,h.length,...s)}catch(s){const e=s;l.error("数据获取失败: "+(((t=e.response)==null?void 0:t.message)||e.message))}};b(i);const c=d(!1),f=d(!1),o=d("");b(()=>{g()});const g=async()=>{var t;try{const s=await I(),e=s==null?void 0:s.is_running;c.value=e,e?l.success("任务正在运行"):l.info("任务没有运行")}catch(s){const e=s;l.error("无法检查定时任务状态: "+(((t=e.response)==null?void 0:t.message)||e.message)),c.value=!1}},S=async()=>{var t;try{l.success("定时更新任务已启动"),c.value=!0;const s=await A();if(s.status==="success"){const e=s.message;o.value=e;let a=0;p.value=setInterval(async()=>{a++,await i(),console.log(`更新次数: ${a}`)},1*60*60*1e3)}else l.error("定时更新任务 数据拉取错误: "+s.message)}catch(s){const e=s;l.error("启动定时更新任务失败: "+(((t=e.response)==null?void 0:t.message)||e.message))}};setInterval(i,1*60*1e3+15e3);const U=async()=>{var t;try{const s=await M();p.value&&(clearInterval(p.value),p.value=null),l.success("定时更新任务已停止");const e=s.message;o.value=e,c.value=!1}catch(s){const e=s;l.error("停止定时更新任务失败: "+(((t=e.response)==null?void 0:t.message)||e.message))}},C=async()=>{var t;try{f.value=!0,o.value="正在一次性更新数据...";const s=await P(),e=s.message;o.value=e,s.status==="success"?(await i(),l.success("本次手动更新完成")):l.success("更新未成功")}catch(s){const e=s;l.error("手动更新任务失败: "+(((t=e.response)==null?void 0:t.message)||e.message)),o.value="手动更新任务失败"}finally{f.value=!1}};return(t,s)=>{const e=w("el-button"),a=w("el-table-column");return n(),m("div",j,[y("div",T,[c.value?v("",!0):(n(),x(e,{key:0,type:"success",onClick:S,class:"w-48"},{default:u(()=>[_(" 开始定时拉取 ")]),_:1})),c.value?(n(),x(e,{key:1,type:"danger",onClick:U,class:"w-48"},{default:u(()=>[_(" 停止定时拉取 ")]),_:1})):v("",!0),r(e,{type:"primary",disabled:f.value,onClick:C,class:"w-48"},{default:u(()=>[_(" 手动拉取 ")]),_:1},8,["disabled"]),r(e,{type:"info",onClick:g,class:"w-48"},{default:u(()=>[_(" 检查定时任务状态 ")]),_:1})]),c.value?(n(),m("p",D," 定时任务正在运行 ")):(n(),m("p",F,"定时任务未运行")),o.value?(n(),m("p",q,V(o.value),1)):v("",!0),O,Z,r(k(B),{data:k(h),stripe:"","highlight-current-row":"",style:{width:"100%"}},{default:u(()=>[r(a,{prop:"user_name",label:"申请人"}),r(a,{prop:"repo",label:"仓库",width:"80"}),r(a,{prop:"role",label:"角色"}),r(a,{prop:"content",label:"内容"}),r(a,{prop:"amount",label:"数额"}),r(a,{prop:"record_time",label:"产生时间"}),r(a,{prop:"apply_status",label:"申请状态"}),r(a,{prop:"apply_time",label:"申请时间"}),r(a,{prop:"decision",label:"审批决定"})]),_:1},8,["data"])])}}});export{Q as default};
