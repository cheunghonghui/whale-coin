import{j as A,b as M,s as P,k as B,l as E}from"./api-B2IVDk6a.js";import{a as l,E as N}from"./index-DC9ExvCA.js";import{m as V,a as d,Z as j,d as w,ah as b,p as n,q as m,t as h,M as x,O as u,S as _,R as y,U as o,T as k,u as S}from"./vue-DRvwLzXx.js";import"./base-BDaasHXh.js";import"./index-kI_rcZ0B.js";import"./crypto-BjADBdty.js";const T={class:"flex flex-col items-center justify-center space-y-2 p-4"},D={class:"flex flex-row items-center justify-center space-x-4"},F={key:0,class:"text-green-500 mt-2"},q={key:1,class:"text-red-500 mt-2"},O={key:2,class:"text-gray-500 mt-2"},Z=h("br",null,null,-1),$=h("h2",{class:"text-center"},"全部鲸币申请",-1),z={style:{width:"100%","max-height":"200px",overflow:"auto"}},X=V({__name:"FetchRepo",setup(G){const p=d(null);document.title="数据更新";let f=j([]);const i=async()=>{var t;try{const s=await M();f.splice(0,f.length,...s)}catch(s){const e=s;l.error("数据获取失败: "+(((t=e.response)==null?void 0:t.message)||e.message))}};w(i);const r=d(!1),v=d(!1),c=d("");w(()=>{g()});const g=async()=>{var t;try{const s=await A(),e=s==null?void 0:s.is_running;r.value=e,e?l.success("任务正在运行"):l.info("任务没有运行")}catch(s){const e=s;l.error("无法检查定时任务状态: "+(((t=e.response)==null?void 0:t.message)||e.message)),r.value=!1}},U=async()=>{var t;try{l.success("定时更新任务已启动"),r.value=!0;const s=await P();if(s.status==="success"){const e=s.message;c.value=e;let a=0;p.value=setInterval(async()=>{a++,await i(),console.log(`更新次数: ${a}`)},1*60*60*1e3)}else l.error("定时更新任务 数据拉取错误: "+s.message)}catch(s){const e=s;l.error("启动定时更新任务失败: "+(((t=e.response)==null?void 0:t.message)||e.message))}};setInterval(i,1*60*1e3+15e3);const C=async()=>{var t;try{const s=await B();p.value&&(clearInterval(p.value),p.value=null),l.success("定时更新任务已停止");const e=s.message;c.value=e,r.value=!1}catch(s){const e=s;l.error("停止定时更新任务失败: "+(((t=e.response)==null?void 0:t.message)||e.message))}},I=async()=>{var t;try{v.value=!0,c.value="正在一次性更新数据...";const s=await E(),e=s.message;c.value=e,s.status==="success"?(await i(),l.success("本次手动更新完成")):l.success("更新未成功")}catch(s){const e=s;l.error("手动更新任务失败: "+(((t=e.response)==null?void 0:t.message)||e.message)),c.value="手动更新任务失败"}finally{v.value=!1}};return(t,s)=>{const e=b("el-button"),a=b("el-table-column");return n(),m("div",T,[h("div",D,[r.value?y("",!0):(n(),x(e,{key:0,type:"success",onClick:U,class:"w-48"},{default:u(()=>[_(" 开始定时拉取 ")]),_:1})),r.value?(n(),x(e,{key:1,type:"danger",onClick:C,class:"w-48"},{default:u(()=>[_(" 停止定时拉取 ")]),_:1})):y("",!0),o(e,{type:"primary",disabled:v.value,onClick:I,class:"w-48"},{default:u(()=>[_(" 手动拉取 ")]),_:1},8,["disabled"]),o(e,{type:"info",onClick:g,class:"w-48"},{default:u(()=>[_(" 检查定时任务状态 ")]),_:1})]),r.value?(n(),m("p",F," 定时任务正在运行 ")):(n(),m("p",q,"定时任务未运行")),c.value?(n(),m("p",O,k(c.value),1)):y("",!0),Z,$,o(S(N),{data:S(f),stripe:"","highlight-current-row":"",style:{width:"100%"}},{default:u(()=>[o(a,{prop:"user_name",label:"申请人"}),o(a,{prop:"repo",label:"仓库",width:"80"}),o(a,{prop:"role",label:"角色"}),o(a,{prop:"content",label:"内容",width:"800"},{default:u(R=>[h("div",z,k(R.row.content),1)]),_:1}),o(a,{prop:"amount",label:"数额"}),o(a,{prop:"record_time",label:"产生时间"}),o(a,{prop:"apply_status",label:"申请状态"}),o(a,{prop:"apply_time",label:"申请时间"}),o(a,{prop:"decision",label:"审批决定"})]),_:1},8,["data"])])}}});export{X as default};
